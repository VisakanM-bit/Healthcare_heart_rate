<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Heart-Rate Result</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{margin:0;background:linear-gradient(135deg,#b3ffab,#12fff7);
     font-family:Segoe UI,Roboto,sans-serif;text-align:center;padding:20px;}
.container{max-width:960px;margin:auto;background:#fff;border-radius:20px;
           box-shadow:0 8px 25px rgba(0,0,0,0.2);padding:30px;}
.progress{width:100%;height:10px;background:#eee;border-radius:5px;margin:10px 0;}
.bar{height:100%;width:0;background:linear-gradient(90deg,#00aaff,#0072ff);border-radius:5px;}
video{border-radius:12px;margin-top:10px;}
h1{margin-top:0;}
canvas{max-width:95%;margin:20px auto;}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ’— Heart-Rate Analysis</h1>
{% if video %}
<video width="360" height="240" controls>
  <source src="/uploads/{{video}}" type="video/mp4">
</video>
{% endif %}
<div id="status">Processing status: Queued</div>
<div class="progress"><div class="bar" id="bar"></div></div>
<h2 id="overall">Overall BPM: --</h2>
<canvas id="intChart"></canvas>
<canvas id="bpmChart"></canvas>
<form action="/" method="get">
  <button style="background:#0078ff;color:#fff;border:none;padding:10px 20px;
         border-radius:10px;cursor:pointer;">ğŸ” Predict Another</button>
</form>
</div>
<script>
const bar=document.getElementById('bar'),st=document.getElementById('status'),
overall=document.getElementById('overall');
const ic=new Chart(document.getElementById('intChart'),{
 type:'line',data:{labels:[],datasets:[{label:'Green Intensity',
 data:[],borderColor:'#0078ff',borderWidth:2,pointRadius:0,tension:0.25}]},
 options:{scales:{x:{title:{display:true,text:'Time (s)'}},
                  y:{title:{display:true,text:'Intensity'}}}}});
const bc=new Chart(document.getElementById('bpmChart'),{
 type:'line',data:{labels:[],datasets:[{label:'BPM',
 data:[],borderColor:'#e63946',borderWidth:2,pointRadius:3,tension:0.25}]},
 options:{scales:{x:{title:{display:true,text:'Time (s)'}},
                  y:{title:{display:true,text:'BPM'}}}}});
let poll=setInterval(async()=>{
 const r=await fetch('/progress');const d=await r.json();
 st.textContent="Processing status: "+d.status+" â€” "+(d.step||"");
 bar.style.width=(d.pct||0)+'%';
 if(d.intensities){
   ic.data.labels=d.times;ic.data.datasets[0].data=d.intensities;ic.update();
 }
 if(d.bpm_t){
   bc.data.labels=d.bpm_x;bc.data.datasets[0].data=d.bpm_t;bc.update();
 }
 overall.textContent="Overall BPM: "+(d.overall?d.overall.toFixed(2):"--");
 if(d.status==="done"||String(d.status).startsWith("error"))clearInterval(poll);
},800);
</script>
</body>
</html>
